'use strict';var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[Symbol.iterator])return a[Symbol.iterator]();if(!(a instanceof Array||"string"==typeof a||a instanceof String))throw new TypeError(a+" is not iterable");var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.arrayFromArguments=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if($jscomp.global.Object.defineProperties){var l=$jscomp.global.Object.getOwnPropertyDescriptor(b,d);void 0!==l&&$jscomp.global.Object.defineProperty(a,d,l)}else a[d]=b[d]};
(function(a){a.CLMS=a.CLMS||{};a.CLMS.model=a.CLMS.model||{};a.CLMS.model.SearchResultsModel=Backbone.Model.extend({defaults:{interactors:new Map,matches:[],crossLinks:new Map,proteinLinks:new Map,minScore:NaN,maxScore:NaN,groups:new Set},initialize:function(b){function c(b){if(b.accession){var c=function(){d3.text("http://www.uniprot.org/uniprot/"+f+".txt",function(c){"undefined"!==typeof Storage&&a.localStorage.setItem("xiNET.UniProtKB."+f,c);d(b,c)})},f=b.accession;if(Storage){var e=a.localStorage.getItem("xiNET.UniProtKB."+
f);e?(console.log(f+" UniProt from local storage."),d(b,e)):(console.log(f+" UniProt not in local storage."),c())}else c()}else w--,0===w&&l()}function d(a,b){for(var c=[],d="",e=b.split("\n"),k=e.length,x=1;x<k;x++){var g=e[x];if(0===g.indexOf("DR")){t.lastIndex=0;var h=t.exec(g);h&&y.add(h[1].toString().trim())}if(0===g.indexOf("FT")&&(h=g.split(/\s{2,}/g),4<h.length)){z.add(h[1]);var m=h[4].substring(0,h[4].indexOf("."));c.push(new CLMS.model.AnnotatedRegion(m,h[2],h[3],null,h[4]))}if(0===g.indexOf("SQ"))for(x++,
x;x<k;x++)g=e[x],d+=g}a.uniprotFeatures=c;d=d.replace(/[^A-Z]/g,"");a.canonicalSeq=d;w--;0===w&&l()}function l(){m.set("candidatePDBs",y);m.set("uniprotFeatureTypes",z);CLMSUI.vent.trigger("uniprotDataParsed",m)}var m=this,e=this.get("interactors");if(b.rawInteractors){var p=$jscomp.makeIterator(b.rawInteractors);for(b=p.next();!b.done;b=p.next()){b=b.value;var h=new CLMS.model.Protein(b[0],b[1],b[2]);h.setSequence(b[3]);e.set(h.id,h)}}if(e=tempMatches){var p=this.get("matches"),h=this.get("minScore"),
k=this.get("maxScore"),g=this.get("groups"),v=e.length;console.log("l "+v);for(b=0;b<v;b++){var u=new CLMS.model.SpectrumMatch(this,e[b][0],e[b][1],e[b][2],e[b][3],e[b][4],e[b][5],e[b][6],e[b][7],e[b][8],e[b][9],e[b][10],e[b][11],e[b][12],e[b][13],e[b][14],e[b][15]);p.push(u);if(!k||u.score>k)k=u.score;else if(!h||u.score<h)h=this.score;g.add(u.group)}}var e=this.get("interactors"),w=e.size,t=/DR...PDB;.(....);/g,y=new Set,z=new Set;b=$jscomp.makeIterator(e.values());for(e=b.next();!e.done;e=b.next())h=
e.value,c(h)}})})(this);CLMS.model.SpectrumMatch=function(a,b,c,d,l,m,e,p,h,k,g,v,u,w,t,y){function z(a){a=a.toString().trim();if("-"!==a&&"n/a"!==a){CLMS.model.SpectrumMatch.eliminateQuotes.lastIndex=0;a=a.replace(CLMS.model.SpectrumMatch.eliminateQuotes,"");CLMS.model.SpectrumMatch.split.lastIndex=0;a=a.split(CLMS.model.SpectrumMatch.split);for(var b=a.length,c=0;c<b;c++)a[c]=a[c].trim()}else a=null;return a}function A(a){if(a)if(a=a.toString().trim(),""!==a&&"-"!==a&&"n/a"!==a){CLMS.model.SpectrumMatch.eliminateQuotes.lastIndex=
0;a=a.toString().replace(CLMS.model.SpectrumMatch.eliminateQuotes,"");CLMS.model.SpectrumMatch.split.lastIndex=0;a=a.split(CLMS.model.SpectrumMatch.split);for(var b=a.length,c=0;c<b;c++){var d=parseInt(a[c]);isNaN(d)?console.debug("Absurd non-numerical position. CLMS.model.SpectrumMatch id:"+B.id+". So-called 'position':"+a[c]):a[c]=d}}else a=null;else a=null;return a}this.id=b.toString().trim();this.containingModel=a;this.crossLinks=[];this.group=v.toString().trim();t&&(this.runName=t.toString().trim());
y&&(this.scanNumber=y.toString().trim());g&&(g=parseFloat(g),isNaN(g)||(this.score=g));u&&(u=u.toString().trim(),""!==u&&(this.autovalidated="t"==u||"true"==u||!0===u?!0:!1,CLMS.model.SpectrumMatch.autoValidatedFound=!0));w&&(this.validated=w=w.toString().trim(),CLMS.model.SpectrumMatch.manualValidatedFound=!0);c=z(c);e=z(e);this.pepSeq1raw=l;this.pepSeq2raw=h;this.pepSeq1=null;l&&(CLMS.model.SpectrumMatch.capitalsOnly.lastindex=0,this.pepSeq1=l.replace(CLMS.model.SpectrumMatch.capitalsOnly,""));
this.pepSeq2=null;h&&(CLMS.model.SpectrumMatch.capitalsOnly.lastindex=0,this.pepSeq2=h.replace(CLMS.model.SpectrumMatch.capitalsOnly,""));var B=this;d=A(d);p=A(p);m=A(m);k=A(k);1==d.length&&1==p.length&&(CLMS.model.SpectrumMatch.unambigLinkFound=!0);this.productType=null===e&&null===p&&null===k?0:null===e?1:2;var f,r,n,q;if(c){if(0===this.productType)if(null!==d)for(a=0;a<d.length;a++)f=a,f>=c.length&&(f=c.length-1),f=c[f],n=d[a],n+=m[0]-1,this.associateWithLink(f,null,n,null,d[a],this.pepSeq1.length,
null,null);else for(a=0;a<m.length;a++)f=a,f>=c.length&&(f=c.length-1),f=c[f],n=m[a],this.associateWithLink(f,null,n,null,null,null,null,null);else if(1===this.productType)if(null!==d)for(a=0;a<d.length;a++)f=a,f>=c.length&&(f=c.length-1),f=c[f],n=d[a],q=p?p[a]:d[a],null!==m&&(n+=m[0]-1),null!==k&&(q+=k[0]-1),this.associateWithLink(f,null,n,q,d[a],this.pepSeq1.length,null,null);else for(a=0;a<m.length;a++)f=a,f>=c.length&&(f=c.length-1),f=c[f],n=m[0],q=k[0],this.associateWithLink(f,null,n,q,null,
null,null,null);else if(null!==d){if(null!==d)for(a=0;a<d.length;a++)for(b=0;b<p.length;b++)f=a,r=b,f>=c.length&&(f=c.length-1),r>=e.length&&(r=e.length-1),f=c[f],r=e[r],n=d[a]-0,q=p[b]-0,null!==m&&(n+=m-1),null!==k&&(q+=k-1),this.associateWithLink(f,r,n,q,d[a]-0,this.pepSeq1.length,p[b],this.pepSeq2.length)}else for(a=0;a<m.length;a++)for(b=0;b<k.length;b++)f=a,r=b,f>=c.length&&(f=c.length-1),r>=e.length&&(r=e.length-1),f=c[f],r=e[r],n=m[a]-0,q=k[b]-0,this.associateWithLink(f,r,n,q,null,null,null,
null);this.confirmedHomomultimer=!1;this.overlap=[];f===r&&(this.pepSeq1&&this.pepSeq2?(f=d[0],r=p[0],q=f+(this.pepSeq1.length-1),n=r+(this.pepSeq2.length-1),f>=r&&f<=n?(this.confirmedHomomultimer=!0,this.overlap[0]=f-1,this.overlap[1]=q<n?q:n):r>=f&&r<=q&&(this.confirmedHomomultimer=!0,this.overlap[0]=r-1,this.overlap[1]=n<q?n:q)):n===q&&(this.confirmedHomomultimer=!0,this.overlap[0]=n-1,this.overlap[1]=q));this.protein1=c;this.pepPos1=d;this.linkPos1=m;this.protein2=e;this.pepPos2=p;this.linkPos2=
k}};CLMS.model.SpectrumMatch.autoValidatedFound=!1;CLMS.model.SpectrumMatch.manualValidatedFound=!1;CLMS.model.SpectrumMatch.unambigLinkFound=!1;CLMS.model.SpectrumMatch.eliminateQuotes=/(['"])/g;CLMS.model.SpectrumMatch.split=/[;,]/g;CLMS.model.SpectrumMatch.capitalsOnly=/[^A-Z]/g;
CLMS.model.SpectrumMatch.prototype.associateWithLink=function(a,b,c,d,l,m,e,p){var h,k,g,v=this.containingModel.get("interactors"),u=this.containingModel.get("crossLinks"),w=this.containingModel.get("proteinLinks");null===b?(k=this.containingModel.proteins.get(a),null===d?(h=""+a+"-null",g=null):(h=""+a+"-"+a,g=k)):a<=b?(h=""+a+"-"+b,k=v.get(a),g=null!==b?v.get(b):null):(h=""+b+"-"+a,k=v.get(b),g=v.get(a));var t=w.get(h);void 0===t&&(void 0!==k&&void 0!==g||alert("Something has gone wrong; a link has been added before a protein it links to. "+
a+"-"+b),t=new CLMS.model.ProteinLink(h,k,g,this.containingModel),w.set(h,t),k.addLink(t),null!==g&&g.addLink(t));h=!1;a===b||null===b?c-0<d-0||null===d?g=c+"-"+d:(g=d+"-"+c,h=!0):a<b?g=c+"-"+d:(g=d+"-"+c,h=!0);k=t.crossLinks.get(g);void 0===k&&(k=a===b?c-0<d-0||"n/a"===d?new CLMS.model.CrossLink(g,t,c,d,this.containingModel):new CLMS.model.CrossLink(g,t,d,c,this.containingModel):a==t.fromProtein.id?new CLMS.model.CrossLink(g,t,c,d,this.containingModel):new CLMS.model.CrossLink(g,t,d,c,this.containingModel),
t.crossLinks.set(g,k),u.set(g,k),1<v.keys().length&&(a=t.crossLinks.keys().length,a>ProteinLink.maxNoCrossLinks&&(ProteinLink.maxNoCrossLinks=a)));!1===h?k.matches.push([this,l,m,e,p]):k.matches.push([this,e,p,l,m]);this.crossLinks.push(k)};CLMS.model.SpectrumMatch.prototype.isAmbig=function(){return 1<this.crossLinks.length?!0:!1};CLMS.model.Protein=function(a,b,c){this.id=a;this.accession=b;this.name=c;!this.name&&b?this.name=b:this.name||(this.name=a);this.proteinLinks=new Map;this.annotatedRegions=this.selfLink=null};
CLMS.model.Protein.prototype.setSequence=function(a){/\d/.test(a)&&(this.isotopicLabeling="",-1!==a.indexOf("K4")&&(this.labeling+="K4"),-1!==a.indexOf("K6")&&(this.labeling+="K6"),-1!==a.indexOf("K8")&&(this.labeling+="K8"),-1!==a.indexOf("K10")&&(this.labeling+="R4"),-1!==a.indexOf("R6")&&(this.labeling+="R6"),-1!==a.indexOf("R8")&&(this.labeling+="R8"),-1!==a.indexOf("R10")&&(this.labeling+="R10"));this.sequence=a.replace(/[^A-Z]/g,"");this.size=this.sequence.length};
CLMS.model.Protein.prototype.isDecoy=function(){return this.name?0===this.name.indexOf("DECOY_")||0===this.name.indexOf("REV")?!0:!1:!1};CLMS.model.Protein.prototype.addLink=function(a){this.proteinLinks.has(a.id)||this.proteinLinks.set(a.id,a);!0===a.isSelfLink()&&(this.selfLink=a);null===a.toProtein&&(this.linkerModifications=a)};
CLMS.model.Protein.prototype.countExternalLinks=function(){for(var a=0,b=this.proteinLinks.keys().length,c=0;c<b;c++){var d=this.proteinLinks.values()[c];d.selfLink()||!0===d.check()&&a++}return a};CLMS.model.Protein.prototype.getSubgraph=function(a){null==this.subgraph&&(a={nodes:new Map,links:new Map},a.nodes.set(this.id,this),!1===this.isParked&&(this.subgraph=this.addConnectedNodes(a)));return this.subgraph};
CLMS.model.Protein.prototype.addConnectedNodes=function(a){for(var b=this.proteinLinks.values(),c=b.length,d=0;d<c;d++){var l=b[d];l.fromCLMS.model.Protein===l.toCLMS.model.Protein||!0!==l.check()||a.links.has(l.id)||(a.links.set(l.id,l),l=l.getFromCLMS.model.Protein()===this?l.getToCLMS.model.Protein():l.getFromCLMS.model.Protein(),null===l||a.nodes.has(l.id)||(a.nodes.set(l.id,l),l.subgraph=a,l.addConnectedNodes(a)))}return a};CLMS.model.AnnotatedRegion=function(a,b,c,d,l){this.name=a;this.start=b-0;this.end=c-0;void 0!==d&&null!==d&&(this.colour=d);this.notes=l};CLMS.model.ProteinLink=function(a,b,c){this.id=a;this.crossLinks=new Map;this.fromProtein=b;this.toProtein=c;this.isSelected=this.ambig=!1};CLMS.model.ProteinLink.maxNoCrossLinks=0;CLMS.model.ProteinLink.prototype.isSelfLink=function(){return this.fromProtein===this.toProtein};CLMS.model.ProteinLink.prototype.isAmbiguous=function(){return this.ambig};CLMS.model.ProteinLink.prototype.hasConfirmedHomomultimer=function(){return this.confirmedHomomultimer};
CLMS.model.ProteinLink.prototype.getFromProtein=function(){return this.fromProtein};CLMS.model.ProteinLink.prototype.getToProtein=function(){return this.toProtein};CLMS.model.ProteinLink.prototype.getFilteredMatches=function(){for(var a=this.crossLinks.values(),b=a.length,c=new Map,d=0;d<b;d++)for(var l=a[d],m=l.matches.length,e=0;e<m;e++){var p=l.matches[e];p.meetsFilterCriteria()&&c.set(p.id)}return c.keys()};
CLMS.model.ProteinLink.prototype.check=function(){if(this.fromProtein.isParked||null!==this.toProtein&&this.toProtein.isParked)return this.hide(),!1;if(this.selfLink()&&!1===this.controller.selfLinksShown){if(0===this.fromProtein.form)this.hide();else for(var a=this.crossLinks.values(),b=a.length,c=0;c<b;c++)a[c].hide();return!1}if(this.hidden){if(0===this.fromProtein.form&&null!==this.toProtein&&0===this.toProtein.form)this.hide();else for(a=this.crossLinks.values(),b=a.length,c=0;c<b;c++)a[c].hide();
return!1}a=this.crossLinks.values();b=a.length;this.confirmedHomomultimer=!1;if(0===this.fromProtein.form&&null!==this.toProtein&&0===this.toProtein.form){this.ambig=!0;for(var d=[],l=new Map,m=new Map,c=0;c<b;c++){var e=a[c],p=!1;if(e.matches)for(var h=e.matches.length,k=0;k<h;k++){var g=e.matches[k][0];if(g.meetsFilterCriteria())if(!0===g.hd&&(this.confirmedHomomultimer=!0),!1===p&&(p=!0,d.push(e)),l.set(g.id,g),g.isAmbig())for(var v=0;v<g.crossLinks.length;v++)m.set(g.crossLinks[v].proteinLink.id);
else this.ambig=!1}else d.push(e)}a=d.length;if(0<a)return this.tooltip=this.id+", "+a+" unique cross-link",1<a&&(this.tooltip+="s"),this.tooltip+=" ("+filteredCLMS.model.SpectrumMatches.keys().length,1===filteredCLMS.model.SpectrumMatches.keys().length?this.tooltip+=" match)":this.tooltip+=" matches)",this.w=45/CLMS.model.ProteinLink.maxNoCrossLinks*a,this.ambig=this.ambig&&1<altCLMS.model.ProteinLinks.keys().length,this.dashedLine(this.ambig),!0;this.hide();return!1}if(null!==this.toProtein||0!==
this.fromProtein.form){c=!1;for(d=0;d<b;d++)!0===a[d].check()&&(c=!0);return c}};CLMS.model.ProteinLink.prototype.getOtherEnd=function(a){return this.fromProtein===a?this.toProtein:this.fromProtein};CLMS.model.CrossLink=function(a,b,c,d){this.id=a;this.matches=[];this.filteredMatches=[];this.proteinLink=b;this.fromResidue=c;this.toResidue=d;this.ambig=!1};CLMS.model.CrossLink.prototype.isSelfLink=function(){return this.proteinLink.fromProtein===this.proteinLink.toProtein};CLMS.model.CrossLink.prototype.isAmbiguous=function(){return this.ambig};CLMS.model.CrossLink.prototype.hasConfirmedHomomultimer=function(){return this.confirmedHomomultimer};CLMS.model.CrossLink.prototype.getFromProtein=function(){return this.proteinLink.fromProtein};
CLMS.model.CrossLink.prototype.getToProtein=function(){return this.proteinLink.toProtein};CLMS.model.CrossLink.prototype.getFilteredMatches=function(){return this.filteredMatches};
CLMS.model.CrossLink.prototype.check=function(a){if(!1===this.controller.selfLinkShown&&this.selfLink()||this.proteinLink.hidden)return this.hide(),!1;if("undefined"===typeof this.matches||null==this.matches)return this.ambig=!1,this.show(),!0;this.getFilteredCLMS.model.SpectrumMatches();return 0<filteredCLMS.model.SpectrumMatches.length?!0:!1};
