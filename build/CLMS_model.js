'use strict';var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[Symbol.iterator])return a[Symbol.iterator]();if(!(a instanceof Array||"string"==typeof a||a instanceof String))throw new TypeError(a+" is not iterable");var d=0;return{next:function(){return d==a.length?{done:!0}:{done:!1,value:a[d++]}}}};$jscomp.arrayFromIterator=function(a){for(var d,b=[];!(d=a.next()).done;)b.push(d.value);return b};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.arrayFromArguments=function(a){for(var d=[],b=0;b<a.length;b++)d.push(a[b]);return d};$jscomp.inherits=function(a,d){function b(){}b.prototype=d.prototype;a.prototype=new b;a.prototype.constructor=a;for(var c in d)if($jscomp.global.Object.defineProperties){var e=$jscomp.global.Object.getOwnPropertyDescriptor(d,c);void 0!==e&&$jscomp.global.Object.defineProperty(a,c,e)}else a[c]=d[c]};
(function(a){a.CLMS=a.CLMS||{};a.CLMS.model=a.CLMS.model||{};a.CLMS.model.SearchResultsModel=Backbone.Model.extend({defaults:{interactors:new Map,matches:[],crossLinks:new Map,proteinLinks:new Map,minScore:NaN,maxScore:NaN,groups:new Set},constructor:function(a,b){Backbone.Model.apply(this);if(a)for(var c=this.get("interactors"),e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next()){var f=f.value,m=new CLMS.model.Protein(f[0],f[1],f[3]);m.setSequence(f[2]);c.set(m.id,m)}if(b){var c=this.get("matches"),
e=this.get("minScore"),m=this.get("maxScore"),n=this.get("groups"),l=b.length;console.log("l "+l);for(f=0;f<l;f++){var h=new CLMS.model.SpectrumMatch(this,tempMatches[f][0],tempMatches[f][1],tempMatches[f][2],tempMatches[f][3],tempMatches[f][4],tempMatches[f][5],tempMatches[f][6],tempMatches[f][7],tempMatches[f][8],tempMatches[f][9],tempMatches[f][10],tempMatches[f][11],tempMatches[f][12],tempMatches[f][13],tempMatches[f][14],tempMatches[f][15]);c.push(h);if(!m||h.score>m)m=h.score;else if(!e||h.score<
e)e=this.score;n.add(h.group)}}}})})(this);CLMS.model.SpectrumMatch=function(a,d,b,c,e,f,m,n,l,h,k,t,v,w,u,y){function z(a){a=a.toString().trim();if("-"!==a&&"n/a"!==a){CLMS.model.SpectrumMatch.eliminateQuotes.lastIndex=0;a=a.replace(CLMS.model.SpectrumMatch.eliminateQuotes,"");CLMS.model.SpectrumMatch.split.lastIndex=0;a=a.split(CLMS.model.SpectrumMatch.split);for(var b=a.length,c=0;c<b;c++)a[c]=a[c].trim()}else a=null;return a}function x(a){if(a)if(a=a.toString().trim(),""!==a&&"-"!==a&&"n/a"!==a){CLMS.model.SpectrumMatch.eliminateQuotes.lastIndex=
0;a=a.toString().replace(CLMS.model.SpectrumMatch.eliminateQuotes,"");CLMS.model.SpectrumMatch.split.lastIndex=0;a=a.split(CLMS.model.SpectrumMatch.split);for(var b=a.length,c=0;c<b;c++){var d=parseInt(a[c]);isNaN(d)?console.debug("Absurd non-numerical position. CLMS.model.SpectrumMatch id:"+A.id+". So-called 'position':"+a[c]):a[c]=d}}else a=null;else a=null;return a}this.id=d.toString().trim();this.containingModel=a;this.crossLinks=[];this.group=t.toString().trim();u&&(this.runName=u.toString().trim());
y&&(this.scanNumber=y.toString().trim());k&&(k=parseFloat(k),isNaN(k)||(this.score=k));v&&(v=v.toString().trim(),""!==v&&(this.autovalidated="t"==v||"true"==v||!0===v?!0:!1,CLMS.model.SpectrumMatch.autoValidatedFound=!0));w&&(this.validated=w=w.toString().trim(),CLMS.model.SpectrumMatch.manualValidatedFound=!0);b=z(b);m=z(m);this.pepSeq1raw=e;this.pepSeq2raw=l;this.pepSeq1=null;e&&(CLMS.model.SpectrumMatch.capitalsOnly.lastindex=0,this.pepSeq1=e.replace(CLMS.model.SpectrumMatch.capitalsOnly,""));
this.pepSeq2=null;l&&(CLMS.model.SpectrumMatch.capitalsOnly.lastindex=0,this.pepSeq2=l.replace(CLMS.model.SpectrumMatch.capitalsOnly,""));var A=this;c=x(c);n=x(n);f=x(f);h=x(h);1==c.length&&1==n.length&&(CLMS.model.SpectrumMatch.unambigLinkFound=!0);this.productType=null===m&&null===n&&null===h?0:null===m?1:2;var g,r,p,q;if(b){if(0===this.productType)if(null!==c)for(a=0;a<c.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],p=c[a],p+=f[0]-1,this.associateWithLink(g,null,p,null,c[a],this.pepSeq1.length,
null,null);else for(a=0;a<f.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],p=f[a],this.associateWithLink(g,null,p,null,null,null,null,null);else if(1===this.productType)if(null!==c)for(a=0;a<c.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],p=c[a],q=n?n[a]:c[a],null!==f&&(p+=f[0]-1),null!==h&&(q+=h[0]-1),this.associateWithLink(g,null,p,q,c[a],this.pepSeq1.length,null,null);else for(a=0;a<f.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],p=f[0],q=h[0],this.associateWithLink(g,null,p,q,null,
null,null,null);else if(null!==c){if(null!==c)for(a=0;a<c.length;a++)for(d=0;d<n.length;d++)g=a,r=d,g>=b.length&&(g=b.length-1),r>=m.length&&(r=m.length-1),g=b[g],r=m[r],p=c[a]-0,q=n[d]-0,null!==f&&(p+=f-1),null!==h&&(q+=h-1),this.associateWithLink(g,r,p,q,c[a]-0,this.pepSeq1.length,n[d],this.pepSeq2.length)}else for(a=0;a<f.length;a++)for(d=0;d<h.length;d++)g=a,r=d,g>=b.length&&(g=b.length-1),r>=m.length&&(r=m.length-1),g=b[g],r=m[r],p=f[a]-0,q=h[d]-0,this.associateWithLink(g,r,p,q,null,null,null,
null);this.confirmedHomomultimer=!1;this.overlap=[];g===r&&(this.pepSeq1&&this.pepSeq2?(g=c[0],r=n[0],q=g+(this.pepSeq1.length-1),p=r+(this.pepSeq2.length-1),g>=r&&g<=p?(this.confirmedHomomultimer=!0,this.overlap[0]=g-1,this.overlap[1]=q<p?q:p):r>=g&&r<=q&&(this.confirmedHomomultimer=!0,this.overlap[0]=r-1,this.overlap[1]=p<q?p:q)):p===q&&(this.confirmedHomomultimer=!0,this.overlap[0]=p-1,this.overlap[1]=q));this.protein1=b;this.pepPos1=c;this.linkPos1=f;this.protein2=m;this.pepPos2=n;this.linkPos2=
h}};CLMS.model.SpectrumMatch.autoValidatedFound=!1;CLMS.model.SpectrumMatch.manualValidatedFound=!1;CLMS.model.SpectrumMatch.unambigLinkFound=!1;CLMS.model.SpectrumMatch.eliminateQuotes=/(['"])/g;CLMS.model.SpectrumMatch.split=/[;,]/g;CLMS.model.SpectrumMatch.capitalsOnly=/[^A-Z]/g;
CLMS.model.SpectrumMatch.prototype.associateWithLink=function(a,d,b,c,e,f,m,n){var l,h,k,t=this.containingModel.get("interactors"),v=this.containingModel.get("crossLinks"),w=this.containingModel.get("proteinLinks");null===d?(h=this.containingModel.proteins.get(a),null===c?(l=""+a+"-null",k=null):(l=""+a+"-"+a,k=h)):a<=d?(l=""+a+"-"+d,h=t.get(a),k=null!==d?t.get(d):null):(l=""+d+"-"+a,h=t.get(d),k=t.get(a));var u=w.get(l);void 0===u&&(void 0!==h&&void 0!==k||alert("Something has gone wrong; a link has been added before a protein it links to. "+
a+"-"+d),u=new CLMS.model.ProteinLink(l,h,k,this.containingModel),w.set(l,u),h.addLink(u),null!==k&&k.addLink(u));l=!1;a===d||null===d?b-0<c-0||null===c?k=b+"-"+c:(k=c+"-"+b,l=!0):a<d?k=b+"-"+c:(k=c+"-"+b,l=!0);h=u.crossLinks.get(k);void 0===h&&(h=a===d?b-0<c-0||"n/a"===c?new CLMS.model.CrossLink(k,u,b,c,this.containingModel):new CLMS.model.CrossLink(k,u,c,b,this.containingModel):a==u.fromProtein.id?new CLMS.model.CrossLink(k,u,b,c,this.containingModel):new CLMS.model.CrossLink(k,u,c,b,this.containingModel),
u.crossLinks.set(k,h),v.set(k,h),1<t.keys().length&&(a=u.crossLinks.keys().length,a>ProteinLink.maxNoCrossLinks&&(ProteinLink.maxNoCrossLinks=a)));!1===l?h.matches.push([this,e,f,m,n]):h.matches.push([this,m,n,e,f]);this.crossLinks.push(h)};CLMS.model.SpectrumMatch.prototype.isAmbig=function(){return 1<this.crossLinks.length?!0:!1};CLMS.model.Protein=function(a,d,b){this.id=a;this.accession=d;this.name=b;!this.name&&d?this.name=d:this.name||(this.name=a);this.proteinLinks=new Map;this.annotatedRegions=this.selfLink=null};
CLMS.model.Protein.prototype.setSequence=function(a){/\d/.test(a)&&(this.isotopicLabeling="",-1!==a.indexOf("K4")&&(this.labeling+="K4"),-1!==a.indexOf("K6")&&(this.labeling+="K6"),-1!==a.indexOf("K8")&&(this.labeling+="K8"),-1!==a.indexOf("K10")&&(this.labeling+="R4"),-1!==a.indexOf("R6")&&(this.labeling+="R6"),-1!==a.indexOf("R8")&&(this.labeling+="R8"),-1!==a.indexOf("R10")&&(this.labeling+="R10"));this.sequence=a.replace(/[^A-Z]/g,"");this.size=this.sequence.length};
CLMS.model.Protein.prototype.isDecoy=function(){return this.name?-1===this.name.indexOf("DECOY_")&&"REV"!==this.name?!1:!0:!1};CLMS.model.Protein.prototype.addLink=function(a){this.proteinLinks.has(a.id)||this.proteinLinks.set(a.id,a);!0===a.isSelfLink()&&(this.selfLink=a);null===a.toProtein&&(this.linkerModifications=a)};
CLMS.model.Protein.prototype.countExternalLinks=function(){for(var a=0,d=this.proteinLinks.keys().length,b=0;b<d;b++){var c=this.proteinLinks.values()[b];c.selfLink()||!0===c.check()&&a++}return a};CLMS.model.Protein.prototype.getSubgraph=function(a){null==this.subgraph&&(a={nodes:new Map,links:new Map},a.nodes.set(this.id,this),!1===this.isParked&&(this.subgraph=this.addConnectedNodes(a)));return this.subgraph};
CLMS.model.Protein.prototype.addConnectedNodes=function(a){for(var d=this.proteinLinks.values(),b=d.length,c=0;c<b;c++){var e=d[c];e.fromCLMS.model.Protein===e.toCLMS.model.Protein||!0!==e.check()||a.links.has(e.id)||(a.links.set(e.id,e),e=e.getFromCLMS.model.Protein()===this?e.getToCLMS.model.Protein():e.getFromCLMS.model.Protein(),null===e||a.nodes.has(e.id)||(a.nodes.set(e.id,e),e.subgraph=a,e.addConnectedNodes(a)))}return a};CLMS.model.AnnotatedRegion=function(a,d,b,c,e){this.name=a;this.start=d-0;this.end=b-0;void 0!==c&&null!==c&&(this.colour=c);this.notes=e};CLMS.model.ProteinLink=function(a,d,b){this.id=a;this.crossLinks=new Map;this.fromProtein=d;this.toProtein=b;this.isSelected=this.ambig=!1};CLMS.model.ProteinLink.maxNoCrossLinks=0;CLMS.model.ProteinLink.prototype.isSelfLink=function(){return this.fromProtein===this.toProtein};CLMS.model.ProteinLink.prototype.isAmbiguous=function(){return this.ambig};CLMS.model.ProteinLink.prototype.hasConfirmedHomomultimer=function(){return this.confirmedHomomultimer};
CLMS.model.ProteinLink.prototype.getFromProtein=function(){return this.fromProtein};CLMS.model.ProteinLink.prototype.getToProtein=function(){return this.toProtein};CLMS.model.ProteinLink.prototype.getFilteredMatches=function(){for(var a=this.crossLinks.values(),d=a.length,b=new Map,c=0;c<d;c++)for(var e=a[c],f=e.matches.length,m=0;m<f;m++){var n=e.matches[m];n.meetsFilterCriteria()&&b.set(n.id)}return b.keys()};
CLMS.model.ProteinLink.prototype.check=function(){if(this.fromProtein.isParked||null!==this.toProtein&&this.toProtein.isParked)return this.hide(),!1;if(this.selfLink()&&!1===this.controller.selfLinksShown){if(0===this.fromProtein.form)this.hide();else for(var a=this.crossLinks.values(),d=a.length,b=0;b<d;b++)a[b].hide();return!1}if(this.hidden){if(0===this.fromProtein.form&&null!==this.toProtein&&0===this.toProtein.form)this.hide();else for(a=this.crossLinks.values(),d=a.length,b=0;b<d;b++)a[b].hide();
return!1}a=this.crossLinks.values();d=a.length;this.confirmedHomomultimer=!1;if(0===this.fromProtein.form&&null!==this.toProtein&&0===this.toProtein.form){this.ambig=!0;for(var c=[],e=new Map,f=new Map,b=0;b<d;b++){var m=a[b],n=!1;if(m.matches)for(var l=m.matches.length,h=0;h<l;h++){var k=m.matches[h][0];if(k.meetsFilterCriteria())if(!0===k.hd&&(this.confirmedHomomultimer=!0),!1===n&&(n=!0,c.push(m)),e.set(k.id,k),k.isAmbig())for(var t=0;t<k.crossLinks.length;t++)f.set(k.crossLinks[t].proteinLink.id);
else this.ambig=!1}else c.push(m)}a=c.length;if(0<a)return this.tooltip=this.id+", "+a+" unique cross-link",1<a&&(this.tooltip+="s"),this.tooltip+=" ("+filteredCLMS.model.SpectrumMatches.keys().length,1===filteredCLMS.model.SpectrumMatches.keys().length?this.tooltip+=" match)":this.tooltip+=" matches)",this.w=45/CLMS.model.ProteinLink.maxNoCrossLinks*a,this.ambig=this.ambig&&1<altCLMS.model.ProteinLinks.keys().length,this.dashedLine(this.ambig),!0;this.hide();return!1}if(null!==this.toProtein||0!==
this.fromProtein.form){b=!1;for(c=0;c<d;c++)!0===a[c].check()&&(b=!0);return b}};CLMS.model.ProteinLink.prototype.getOtherEnd=function(a){return this.fromProtein===a?this.toProtein:this.fromProtein};CLMS.model.CrossLink=function(a,d,b,c){this.id=a;this.matches=[];this.filteredMatches=[];this.proteinLink=d;this.fromResidue=b;this.toResidue=c;this.ambig=!1};CLMS.model.CrossLink.prototype.isSelfLink=function(){return this.proteinLink.fromProtein===this.proteinLink.toProtein};CLMS.model.CrossLink.prototype.isAmbiguous=function(){return this.ambig};CLMS.model.CrossLink.prototype.hasConfirmedHomomultimer=function(){return this.confirmedHomomultimer};CLMS.model.CrossLink.prototype.getFromProtein=function(){return this.proteinLink.fromProtein};
CLMS.model.CrossLink.prototype.getToProtein=function(){return this.proteinLink.toProtein};CLMS.model.CrossLink.prototype.getFilteredMatches=function(){return this.filteredMatches};
CLMS.model.CrossLink.prototype.check=function(a){if(!1===this.controller.selfLinkShown&&this.selfLink()||this.proteinLink.hidden)return this.hide(),!1;if("undefined"===typeof this.matches||null==this.matches)return this.ambig=!1,this.show(),!0;this.getFilteredCLMS.model.SpectrumMatches();return 0<filteredCLMS.model.SpectrumMatches.length?!0:!1};function xiNET_Storage(a){this.controller=a}xiNET_Storage.ns="xiNET.";xiNET_Storage.accessionFromId=function(a){a+="";return-1!==a.indexOf("|")?a.split("|")[1]:a};
xiNET_Storage.prototype.getUniProtTxt=function(a,d){function b(){d3.text("http://www.uniprot.org/uniprot/"+c+".txt",function(b){"undefined"!==typeof Storage&&localStorage.setItem(xiNET_Storage.ns+"UniProtKB."+c,b);d(a,b)})}var c=this.controller.proteins.get(a).accession;if("undefined"!==typeof Storage){var e=localStorage.getItem(xiNET_Storage.ns+"UniProtKB."+c);e?d(a,e):b()}else b()};
xiNET_Storage.prototype.getSequence=function(a,d){function b(){d3.text("http://www.uniprot.org/uniprot/"+c+".fasta",function(b){var e="";b=b.split("\n");for(var n=b.length,l=1;l<n;l++)var h=b[l],h=b[l],e=e+h;e=e.replace(/[^A-Z]/g,"");"undefined"!==typeof Storage&&localStorage.setItem(xiNET_Storage.ns+"UniProtKB.fasta."+c,e);d(a,e)})}var c=this.controller.proteins.get(a).accession;if("undefined"!==typeof Storage){var e=localStorage.getItem(xiNET_Storage.ns+"UniProtKB.fasta."+c);e?d(a,e):b()}else b()};
xiNET_Storage.prototype.getUniProtFeatures=function(a,d){this.getUniProtTxt(a,function(a,c){var e=[];if(null!==c){for(var f=c.split("\n"),m=f.length,n=0;n<m;n++){var l=f[n];if(0===l.indexOf("FT")&&(l=l.split(/\s{2,}/g),4<l.length&&"DOMAIN"===l[1])){var h=l[4].substring(0,l[4].indexOf("."));e.push(new Annotation(h,l[2],l[3],null,l[4]))}}d(a,e)}})};
xiNET_Storage.prototype.getSuperFamFeatures=function(a,d){function b(){d3.xml("http://supfam.org/SUPERFAMILY/cgi-bin/das/up/features?segment="+e,function(a){a=(new XMLSerializer).serializeToString(a);"undefined"!==typeof Storage&&localStorage.setItem(xiNET_Storage.ns+"SuperFamDAS."+e,a);c(a)})}function c(b){if(window.DOMParser)var c=(new DOMParser).parseFromString(b,"text/xml");else c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(b);b=[];for(var c=c.getElementsByTagName("FEATURE"),e=
c.length,f=0;f<e;f++){var k=c[f],t=k.getElementsByTagName("TYPE")[0];if("miscellaneous"===t.getAttribute("category")){var t=t.getAttribute("id"),v=k.getElementsByTagName("START")[0].textContent,k=k.getElementsByTagName("END")[0].textContent;b.push(new Annotation(t,v,k))}}d(a,b)}var e=this.controller.proteins.get(a).accession;if("undefined"!==typeof Storage){var f=localStorage.getItem(xiNET_Storage.ns+"SuperFamDAS."+e);f?c(f):b()}else b()};
