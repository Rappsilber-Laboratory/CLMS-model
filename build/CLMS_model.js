'use strict';var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[Symbol.iterator])return a[Symbol.iterator]();if(!(a instanceof Array||"string"==typeof a||a instanceof String))throw new TypeError(a+" is not iterable");var c=0;return{next:function(){return c==a.length?{done:!0}:{done:!1,value:a[c++]}}}};$jscomp.arrayFromIterator=function(a){for(var c,b=[];!(c=a.next()).done;)b.push(c.value);return b};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.arrayFromArguments=function(a){for(var c=[],b=0;b<a.length;b++)c.push(a[b]);return c};$jscomp.inherits=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;for(var d in c)if($jscomp.global.Object.defineProperties){var f=$jscomp.global.Object.getOwnPropertyDescriptor(c,d);void 0!==f&&$jscomp.global.Object.defineProperty(a,d,f)}else a[d]=c[d]};
(function(a){a.CLMS=a.CLMS||{};a.CLMS.model=a.CLMS.model||{};a.CLMS.model.SearchResultsModel=Backbone.Model.extend({defaults:{interactors:new Map,matches:[],crossLinks:new Map,proteinLinks:new Map,minScore:NaN,maxScore:NaN,groups:new Set},constructor:function(a,b){Backbone.Model.apply(this);var d=this.get("interactors");if(a)for(var f=$jscomp.makeIterator(a),e=f.next();!e.done;e=f.next()){var e=e.value,k=new CLMS.model.Protein(e[0],e[1],e[2]);k.setSequence(e[3]);d.set(k.id,k)}if(b){var d=this.get("matches"),
f=this.get("minScore"),k=this.get("maxScore"),h=this.get("groups"),p=b.length;console.log("l "+p);for(e=0;e<p;e++){var l=new CLMS.model.SpectrumMatch(this,tempMatches[e][0],tempMatches[e][1],tempMatches[e][2],tempMatches[e][3],tempMatches[e][4],tempMatches[e][5],tempMatches[e][6],tempMatches[e][7],tempMatches[e][8],tempMatches[e][9],tempMatches[e][10],tempMatches[e][11],tempMatches[e][12],tempMatches[e][13],tempMatches[e][14],tempMatches[e][15]);d.push(l);if(!k||l.score>k)k=l.score;else if(!f||l.score<
f)f=this.score;h.add(l.group)}}this.initialize()},initialize:function(c){function b(b){if(b.accession){var c=function(){d3.text("http://www.uniprot.org/uniprot/"+e+".txt",function(c){"undefined"!==typeof Storage&&a.localStorage.setItem("xiNET.UniProtKB."+e,c);d(b,c)})},e=b.accession;if(Storage){var h=a.localStorage.getItem("xiNET.UniProtKB."+e);h?(console.log(e+" UniProt from local storage."),d(b,h)):(console.log(e+" UniProt not in local storage."),c())}else c()}else k--,0===k&&f()}function d(a,b){for(var c=
"",d=b.split("\n"),e=d.length,h=1;h<e;h++){var q=d[h];if(0===q.indexOf("SQ"))for(h++,h;h<e;h++)q=d[h],c+=q}c=c.replace(/[^A-Z]/g,"");a.canonicalSeq=c;k--;0===k&&f()}function f(){for(var a=$jscomp.makeIterator(e.values()),b=a.next();!b.done;b=a.next())b=b.value,console.log(b.id+"\t"+b.accession+"\t"+b.sequence),console.log(b.id+"\t"+b.accession+"\t"+b.canonicalSeq);CLMSUI.vent.trigger("uniprotDataParsed")}var e=this.get("interactors"),k=e.size;c=$jscomp.makeIterator(e.values());for(var h=c.next();!h.done;h=
c.next())b(h.value)}})})(this);CLMS.model.SpectrumMatch=function(a,c,b,d,f,e,k,h,p,l,m,u,v,w,q,y){function z(a){a=a.toString().trim();if("-"!==a&&"n/a"!==a){CLMS.model.SpectrumMatch.eliminateQuotes.lastIndex=0;a=a.replace(CLMS.model.SpectrumMatch.eliminateQuotes,"");CLMS.model.SpectrumMatch.split.lastIndex=0;a=a.split(CLMS.model.SpectrumMatch.split);for(var b=a.length,c=0;c<b;c++)a[c]=a[c].trim()}else a=null;return a}function x(a){if(a)if(a=a.toString().trim(),""!==a&&"-"!==a&&"n/a"!==a){CLMS.model.SpectrumMatch.eliminateQuotes.lastIndex=
0;a=a.toString().replace(CLMS.model.SpectrumMatch.eliminateQuotes,"");CLMS.model.SpectrumMatch.split.lastIndex=0;a=a.split(CLMS.model.SpectrumMatch.split);for(var b=a.length,c=0;c<b;c++){var d=parseInt(a[c]);isNaN(d)?console.debug("Absurd non-numerical position. CLMS.model.SpectrumMatch id:"+A.id+". So-called 'position':"+a[c]):a[c]=d}}else a=null;else a=null;return a}this.id=c.toString().trim();this.containingModel=a;this.crossLinks=[];this.group=u.toString().trim();q&&(this.runName=q.toString().trim());
y&&(this.scanNumber=y.toString().trim());m&&(m=parseFloat(m),isNaN(m)||(this.score=m));v&&(v=v.toString().trim(),""!==v&&(this.autovalidated="t"==v||"true"==v||!0===v?!0:!1,CLMS.model.SpectrumMatch.autoValidatedFound=!0));w&&(this.validated=w=w.toString().trim(),CLMS.model.SpectrumMatch.manualValidatedFound=!0);b=z(b);k=z(k);this.pepSeq1raw=f;this.pepSeq2raw=p;this.pepSeq1=null;f&&(CLMS.model.SpectrumMatch.capitalsOnly.lastindex=0,this.pepSeq1=f.replace(CLMS.model.SpectrumMatch.capitalsOnly,""));
this.pepSeq2=null;p&&(CLMS.model.SpectrumMatch.capitalsOnly.lastindex=0,this.pepSeq2=p.replace(CLMS.model.SpectrumMatch.capitalsOnly,""));var A=this;d=x(d);h=x(h);e=x(e);l=x(l);1==d.length&&1==h.length&&(CLMS.model.SpectrumMatch.unambigLinkFound=!0);this.productType=null===k&&null===h&&null===l?0:null===k?1:2;var g,t,n,r;if(b){if(0===this.productType)if(null!==d)for(a=0;a<d.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],n=d[a],n+=e[0]-1,this.associateWithLink(g,null,n,null,d[a],this.pepSeq1.length,
null,null);else for(a=0;a<e.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],n=e[a],this.associateWithLink(g,null,n,null,null,null,null,null);else if(1===this.productType)if(null!==d)for(a=0;a<d.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],n=d[a],r=h?h[a]:d[a],null!==e&&(n+=e[0]-1),null!==l&&(r+=l[0]-1),this.associateWithLink(g,null,n,r,d[a],this.pepSeq1.length,null,null);else for(a=0;a<e.length;a++)g=a,g>=b.length&&(g=b.length-1),g=b[g],n=e[0],r=l[0],this.associateWithLink(g,null,n,r,null,
null,null,null);else if(null!==d){if(null!==d)for(a=0;a<d.length;a++)for(c=0;c<h.length;c++)g=a,t=c,g>=b.length&&(g=b.length-1),t>=k.length&&(t=k.length-1),g=b[g],t=k[t],n=d[a]-0,r=h[c]-0,null!==e&&(n+=e-1),null!==l&&(r+=l-1),this.associateWithLink(g,t,n,r,d[a]-0,this.pepSeq1.length,h[c],this.pepSeq2.length)}else for(a=0;a<e.length;a++)for(c=0;c<l.length;c++)g=a,t=c,g>=b.length&&(g=b.length-1),t>=k.length&&(t=k.length-1),g=b[g],t=k[t],n=e[a]-0,r=l[c]-0,this.associateWithLink(g,t,n,r,null,null,null,
null);this.confirmedHomomultimer=!1;this.overlap=[];g===t&&(this.pepSeq1&&this.pepSeq2?(g=d[0],t=h[0],r=g+(this.pepSeq1.length-1),n=t+(this.pepSeq2.length-1),g>=t&&g<=n?(this.confirmedHomomultimer=!0,this.overlap[0]=g-1,this.overlap[1]=r<n?r:n):t>=g&&t<=r&&(this.confirmedHomomultimer=!0,this.overlap[0]=t-1,this.overlap[1]=n<r?n:r)):n===r&&(this.confirmedHomomultimer=!0,this.overlap[0]=n-1,this.overlap[1]=r));this.protein1=b;this.pepPos1=d;this.linkPos1=e;this.protein2=k;this.pepPos2=h;this.linkPos2=
l}};CLMS.model.SpectrumMatch.autoValidatedFound=!1;CLMS.model.SpectrumMatch.manualValidatedFound=!1;CLMS.model.SpectrumMatch.unambigLinkFound=!1;CLMS.model.SpectrumMatch.eliminateQuotes=/(['"])/g;CLMS.model.SpectrumMatch.split=/[;,]/g;CLMS.model.SpectrumMatch.capitalsOnly=/[^A-Z]/g;
CLMS.model.SpectrumMatch.prototype.associateWithLink=function(a,c,b,d,f,e,k,h){var p,l,m,u=this.containingModel.get("interactors"),v=this.containingModel.get("crossLinks"),w=this.containingModel.get("proteinLinks");null===c?(l=this.containingModel.proteins.get(a),null===d?(p=""+a+"-null",m=null):(p=""+a+"-"+a,m=l)):a<=c?(p=""+a+"-"+c,l=u.get(a),m=null!==c?u.get(c):null):(p=""+c+"-"+a,l=u.get(c),m=u.get(a));var q=w.get(p);void 0===q&&(void 0!==l&&void 0!==m||alert("Something has gone wrong; a link has been added before a protein it links to. "+
a+"-"+c),q=new CLMS.model.ProteinLink(p,l,m,this.containingModel),w.set(p,q),l.addLink(q),null!==m&&m.addLink(q));p=!1;a===c||null===c?b-0<d-0||null===d?m=b+"-"+d:(m=d+"-"+b,p=!0):a<c?m=b+"-"+d:(m=d+"-"+b,p=!0);l=q.crossLinks.get(m);void 0===l&&(l=a===c?b-0<d-0||"n/a"===d?new CLMS.model.CrossLink(m,q,b,d,this.containingModel):new CLMS.model.CrossLink(m,q,d,b,this.containingModel):a==q.fromProtein.id?new CLMS.model.CrossLink(m,q,b,d,this.containingModel):new CLMS.model.CrossLink(m,q,d,b,this.containingModel),
q.crossLinks.set(m,l),v.set(m,l),1<u.keys().length&&(a=q.crossLinks.keys().length,a>ProteinLink.maxNoCrossLinks&&(ProteinLink.maxNoCrossLinks=a)));!1===p?l.matches.push([this,f,e,k,h]):l.matches.push([this,k,h,f,e]);this.crossLinks.push(l)};CLMS.model.SpectrumMatch.prototype.isAmbig=function(){return 1<this.crossLinks.length?!0:!1};CLMS.model.Protein=function(a,c,b){this.id=a;this.accession=c;this.name=b;!this.name&&c?this.name=c:this.name||(this.name=a);this.proteinLinks=new Map;this.annotatedRegions=this.selfLink=null};
CLMS.model.Protein.prototype.setSequence=function(a){/\d/.test(a)&&(this.isotopicLabeling="",-1!==a.indexOf("K4")&&(this.labeling+="K4"),-1!==a.indexOf("K6")&&(this.labeling+="K6"),-1!==a.indexOf("K8")&&(this.labeling+="K8"),-1!==a.indexOf("K10")&&(this.labeling+="R4"),-1!==a.indexOf("R6")&&(this.labeling+="R6"),-1!==a.indexOf("R8")&&(this.labeling+="R8"),-1!==a.indexOf("R10")&&(this.labeling+="R10"));this.sequence=a.replace(/[^A-Z]/g,"");this.size=this.sequence.length};
CLMS.model.Protein.prototype.isDecoy=function(){return this.name?-1===this.name.indexOf("DECOY_")&&"REV"!==this.name?!1:!0:!1};CLMS.model.Protein.prototype.addLink=function(a){this.proteinLinks.has(a.id)||this.proteinLinks.set(a.id,a);!0===a.isSelfLink()&&(this.selfLink=a);null===a.toProtein&&(this.linkerModifications=a)};
CLMS.model.Protein.prototype.countExternalLinks=function(){for(var a=0,c=this.proteinLinks.keys().length,b=0;b<c;b++){var d=this.proteinLinks.values()[b];d.selfLink()||!0===d.check()&&a++}return a};CLMS.model.Protein.prototype.getSubgraph=function(a){null==this.subgraph&&(a={nodes:new Map,links:new Map},a.nodes.set(this.id,this),!1===this.isParked&&(this.subgraph=this.addConnectedNodes(a)));return this.subgraph};
CLMS.model.Protein.prototype.addConnectedNodes=function(a){for(var c=this.proteinLinks.values(),b=c.length,d=0;d<b;d++){var f=c[d];f.fromCLMS.model.Protein===f.toCLMS.model.Protein||!0!==f.check()||a.links.has(f.id)||(a.links.set(f.id,f),f=f.getFromCLMS.model.Protein()===this?f.getToCLMS.model.Protein():f.getFromCLMS.model.Protein(),null===f||a.nodes.has(f.id)||(a.nodes.set(f.id,f),f.subgraph=a,f.addConnectedNodes(a)))}return a};CLMS.model.AnnotatedRegion=function(a,c,b,d,f){this.name=a;this.start=c-0;this.end=b-0;void 0!==d&&null!==d&&(this.colour=d);this.notes=f};CLMS.model.ProteinLink=function(a,c,b){this.id=a;this.crossLinks=new Map;this.fromProtein=c;this.toProtein=b;this.isSelected=this.ambig=!1};CLMS.model.ProteinLink.maxNoCrossLinks=0;CLMS.model.ProteinLink.prototype.isSelfLink=function(){return this.fromProtein===this.toProtein};CLMS.model.ProteinLink.prototype.isAmbiguous=function(){return this.ambig};CLMS.model.ProteinLink.prototype.hasConfirmedHomomultimer=function(){return this.confirmedHomomultimer};
CLMS.model.ProteinLink.prototype.getFromProtein=function(){return this.fromProtein};CLMS.model.ProteinLink.prototype.getToProtein=function(){return this.toProtein};CLMS.model.ProteinLink.prototype.getFilteredMatches=function(){for(var a=this.crossLinks.values(),c=a.length,b=new Map,d=0;d<c;d++)for(var f=a[d],e=f.matches.length,k=0;k<e;k++){var h=f.matches[k];h.meetsFilterCriteria()&&b.set(h.id)}return b.keys()};
CLMS.model.ProteinLink.prototype.check=function(){if(this.fromProtein.isParked||null!==this.toProtein&&this.toProtein.isParked)return this.hide(),!1;if(this.selfLink()&&!1===this.controller.selfLinksShown){if(0===this.fromProtein.form)this.hide();else for(var a=this.crossLinks.values(),c=a.length,b=0;b<c;b++)a[b].hide();return!1}if(this.hidden){if(0===this.fromProtein.form&&null!==this.toProtein&&0===this.toProtein.form)this.hide();else for(a=this.crossLinks.values(),c=a.length,b=0;b<c;b++)a[b].hide();
return!1}a=this.crossLinks.values();c=a.length;this.confirmedHomomultimer=!1;if(0===this.fromProtein.form&&null!==this.toProtein&&0===this.toProtein.form){this.ambig=!0;for(var d=[],f=new Map,e=new Map,b=0;b<c;b++){var k=a[b],h=!1;if(k.matches)for(var p=k.matches.length,l=0;l<p;l++){var m=k.matches[l][0];if(m.meetsFilterCriteria())if(!0===m.hd&&(this.confirmedHomomultimer=!0),!1===h&&(h=!0,d.push(k)),f.set(m.id,m),m.isAmbig())for(var u=0;u<m.crossLinks.length;u++)e.set(m.crossLinks[u].proteinLink.id);
else this.ambig=!1}else d.push(k)}a=d.length;if(0<a)return this.tooltip=this.id+", "+a+" unique cross-link",1<a&&(this.tooltip+="s"),this.tooltip+=" ("+filteredCLMS.model.SpectrumMatches.keys().length,1===filteredCLMS.model.SpectrumMatches.keys().length?this.tooltip+=" match)":this.tooltip+=" matches)",this.w=45/CLMS.model.ProteinLink.maxNoCrossLinks*a,this.ambig=this.ambig&&1<altCLMS.model.ProteinLinks.keys().length,this.dashedLine(this.ambig),!0;this.hide();return!1}if(null!==this.toProtein||0!==
this.fromProtein.form){b=!1;for(d=0;d<c;d++)!0===a[d].check()&&(b=!0);return b}};CLMS.model.ProteinLink.prototype.getOtherEnd=function(a){return this.fromProtein===a?this.toProtein:this.fromProtein};CLMS.model.CrossLink=function(a,c,b,d){this.id=a;this.matches=[];this.filteredMatches=[];this.proteinLink=c;this.fromResidue=b;this.toResidue=d;this.ambig=!1};CLMS.model.CrossLink.prototype.isSelfLink=function(){return this.proteinLink.fromProtein===this.proteinLink.toProtein};CLMS.model.CrossLink.prototype.isAmbiguous=function(){return this.ambig};CLMS.model.CrossLink.prototype.hasConfirmedHomomultimer=function(){return this.confirmedHomomultimer};CLMS.model.CrossLink.prototype.getFromProtein=function(){return this.proteinLink.fromProtein};
CLMS.model.CrossLink.prototype.getToProtein=function(){return this.proteinLink.toProtein};CLMS.model.CrossLink.prototype.getFilteredMatches=function(){return this.filteredMatches};
CLMS.model.CrossLink.prototype.check=function(a){if(!1===this.controller.selfLinkShown&&this.selfLink()||this.proteinLink.hidden)return this.hide(),!1;if("undefined"===typeof this.matches||null==this.matches)return this.ambig=!1,this.show(),!0;this.getFilteredCLMS.model.SpectrumMatches();return 0<filteredCLMS.model.SpectrumMatches.length?!0:!1};
